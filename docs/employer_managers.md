# Менеджеры работодателя

* [Справочник типов и прав менеджера](#dict)
* [Добавление менеджера](#add)
* [Редактирование менеджера](#edit)
* [Удаление менеджера](#delete)
* [Справочник менеджеров работодателя](#list)
* [Получение информации о менеджере](#item)

Для получения информации необходимо авторизоваться под работодателем.
Для пользователя без авторизации или для неправильно авторизованного пользователя вернется ответ `403 Forbidden`.

<a name="dict"></a>
## Справочник типов и прав менеджера

### Запрос
`GET /employers/{employer_id}/manager_types`

 где `employer_id` - идентификатор работодателя, который можно узнать в
 [информации о текущем пользователе](me.md#employer-info).

### Ответ

Пример ответа:
```json
{
    "items": [
        {
            "id": "manager",
            "name": "Менеджер",
            "available_permissions": [
                {
                    "id": "can_create_vacancy",
                    "name": "Создание и продление вакансий"
                },
                {
                    "id": "can_view_resume_contacts",
                    "name": "Просмотр контактов соискателей"
                }
            ]
        }
    ]
}
```

Каждый элемент из `items` обладает следующими полями:

 Имя | Тип | Описание
 --- | --- | ---
 id | строка | идентификатор типа менеджера
 name | строка | название типа менеджера
 available_permissions | список | список прав, которые можно дать данному типу менеджера

Поля объекта списка available_permissions:

 Имя | Тип | Описание
 --- | --- | ---
 id | строка | идентификатор права
 name | строка | название права

### Ошибки
* `404 Not found` - Работодатель не найден, или у пользователя нет прав

<a name="add"></a>
## Добавление менеджера

### Запрос
`POST /employers/{employer_id}/managers`

где `employer_id` - идентификатор работодателя, который можно узнать в
  [информации о текущем пользователе](me.md#employer-info).

В теле запроса передается json вида:

```json
{
    "last_name": "Федотов",
    "first_name": "Илья",
    "middle_name": "Игоревич",
    "manager_type": {
        "id": "manager"
    },
    "position": "Менеджер",
    "email": "test@test.test",
    "area": {
        "id": "1"
    },
    "phone": {
        "country": "7",
        "city": "495",
        "number": "1568055",
        "comment": "с 9 до 17"
    },
    "additional_phone": {
         "country": "7",
         "city": "916",
         "number": "4555555",
         "comment": "личный"
    },
    "permissions": [
       {
           "id": "can_create_vacancy"
       },
       {
           "id": "can_view_resume_contacts"
       }
   ]
}
```

 Имя | Тип | Описание
 --- | --- | ---
 last_name | строка | фамилия
 first_name | строка | имя
 middle_name | строка | отчество
 manager_type.id | строка | идентификатор [типа менеджера](#dict)
 position | строка | должность менеджера
 email | строка | электронная почта менеджера
 area.id | число | регион [из справочника](areas.md)
 phone | объект | телефон менеджера
 additional_phone | объект | дополнительный телефон менеджера
 permissions | список | список [прав менеджера](#dict)

 Поля объеков phone и additional_phone:

 Имя | Тип | Описание
 --- | --- | ---
 country | string | код страны
 city | string | код города
 number | string | телефон
 comment | string или null | комментарий

 Поля объекта списка permissions:

 Имя | Тип | Описание
 --- | --- | ---
 id | строка | идентификатор права
 name | строка | название права

 Все поля, кроме комментария к телефону и прав, являются обязательными

### Ответ

В случае успешного выполнения запроса будет возвращён статус `201 Created`.
Идентификатор созданного менеджера приходит в:

 * теле ответа в виде:
```
 {"id": "78789890"}
```
 * а так же содержится в заголовке `Location`:

```
 HTTP/1.1 201 Created

 Location: /employers/432/managers/78789890
```

### Ошибки

_TODO: расписать, кастомные описать в таблице в errors.md_

* `404 Not Found` – указанный работодатель не существует, или пользователь не имеет прав на создание менеджера
* `400 Bad Request` – параметры во входном json переданы с ошибкой. Будет возвращено описанием ошибки в теле.
Неизвестные параметры и параметры с ошибкой в названии игнорируются.
  * `{"errors":[{"type":"managers","value":"name"}]}` - ошибка в поле
  * `{"errors":[{"type":"bad_json_data","value":"name"}]} ` - ошибка во входных данных (формат json)
* `403 Forbidden`
  * если нет прав на создание менеджера
  * `{"errors":[{"type":"managers", "value": "email", "reason":"already_exist"}]}` - менеджер уже есть


<a name="edit"></a>
## Редактирование менеджера

### Запрос
`PUT /employers/{employer_id}/managers/{manager_id}`

где:

* `employer_id` - идентификатор работодателя, который можно узнать в
  [информации о текущем пользователе](me.md#employer-info).
* `manager_id` - идентификатор менеджера.

В теле запроса передается json вида:

```json
{
    "position": "Менеджер",
    "phone": {
        "country": "7",
        "city": "495",
        "number": "1568055",
        "comment": "с 9 до 17"
    },
    "additional_phone": {
         "country": "7",
         "city": "916",
         "number": "4555555",
         "comment": "личный"
    },
    "permissions": [
       {
           "id": "can_create_vacancy",
           "name": "Создание и продление вакансий"
       },
       {
           "id": "can_view_resume_contacts",
           "name": "Просмотр контактов соискателей"
       }
   ]
}
```

Изменять можно только поля, из приведенного json-примера. Описание полей можно посмотреть в [запросе на создание](#add).
При обновлении можно передавать как все поля, так и часть полей, которые необходимо обновить.

### Ответ

В случае успешного выполнения запроса будет возвращён статус `200 OK`.

### Ошибки

_TODO: расписать, кастомные описать в таблице в errors.md_

* `404 Not Found` – указанный работодатель или менеджер не существует, или пользователь не имеет прав на изменение менеджера
* `400 Bad argument` – параметры во входном json переданы с ошибкой. Будет возвращено описанием ошибки в теле.
Неизвестные параметры и параметры с ошибкой в названии игнорируются.
  * `{"errors":[{"type":"managers","value":"name"}]}` - ошибка в поле
  * `{"errors":[{"type":"bad_json_data","value":"name"}]} ` - ошибка во входных данных (формат json)
* 403
  * `{"errors":[{"type":"managers","value":"%field_name%", "reason": "not_editable"}]}` - поле не редактируется
  * (_TODO: type/value ошибки_) лимит на кол-во менеджеров привышен

<a name="delete"></a>
## Удаление менеджера

**Удаление менеджера происходит не сразу и может занять какое-то время.
По этой причине, если сразу после успешного удаления менеджера вы запросите, например,
 список менеджеров, в ответе может вернуться удаленный менеджер.**

### Запрос

`DELETE /employers/{employer_id}/managers/{manager_id}`

где:

* `employer_id` - идентификатор работодателя, который можно узнать в
  [информации о текущем пользователе](me.md#employer-info).
* `manager_id` - идентификатор менеджера.

На вход в качестве обязательного параметра необходимо передавать:
`successor_id` - идентификатор менеджера, которому передаются данные,
связанные с удаляемым менеджером, в частности: вакансии, отклики, папки отобранных резюме,
комментарии к соискателю, автопоиски удаляемого менеджера

### Ответ

В случае успешного выполнения запроса будет возвращён статус `204 OK`

### Ошибки

* `404 Not Found` – указанный работодатель или менеджер не существует, или пользователь не имеет прав на удаление менеджера
* `400 Bad argument` – параметры во входном json переданы с ошибкой. Будет возвращено описанием ошибки в теле.
Неизвестные параметры и параметры с ошибкой в названии игнорируются.

<a name="list"></a>
## Справочник менеджеров работодателя

### Запрос

`GET /employers/{employer_id}/managers`

где:

* `employer_id` - идентификатор работодателя, который можно узнать в
  [информации о текущем пользователе](me.md#employer-info).

### Ответ

В случае успешного выполнения запроса будет возвращён статус `200 OK`. В
теле ответа будет возвращён список менеджеров работодателя, например:

```json
{
    "items": [
        {
            "id": "1507922",
            "email": "employer@example.com",
            "full_name": "Иванов Иван Иванович",
            "last_name": "Иванов",
            "first_name": "Иван",
            "middle_name": "Иванович",
            "vacancies_count": 0,
            "phone": {
                "country": "7",
                "city": "495",
                "number": "1568055",
                "comment": "с 9 до 17"
            },
            "additional_phone": {
                "country": "7",
                "city": "916",
                "number": "4555555",
                "comment": "личный"
            },
            "position": "Менеджер",
            "area": {
                "id": "1",
                "name": "Москва",
                "url": "https://api.hh.ru/areas/1"
            }
        }
    ]
}
```

В элементе `items` будет содержаться список менеджеров работодателя.
Каждый элемент из `items` обладает полями, описанными в
[добавлении менеджера](#add), кроме поля `permissions` и `manager_type`.

Так же дополнительно выдаются следующие поля:

<a name="fields"></a>

 Имя | Тип | Описание
 --- | --- | ---
 id | строка | Идентификатор менеджера
 full_name | строка | Полное имя менеджера
 vacancies_count | число | количество опубликованных (активных) вакансий у данного менеджера

### Ошибки
 * `403 Forbidden` - С текущей авторизацией запрещено просматривать менеджеров данного работодателя

<a name="item"></a>
## Получение информации о менеджере

### Запрос

`GET /employers/{employer_id}/managers/{manager_id}`

где:

* `employer_id` - идентификатор работодателя, который можно узнать в
  [информации о текущем пользователе](me.md#employer-info).
* `manager_id` - идентификатор менеджера.

### Ответ

В случае успешного выполнения запроса, будет возвращён статус `200 OK`.
В теле ответа будет содержаться информация о менеджере, например:

```json
{
    "id": "1507922",
    "manager_type":{
        "id": "manager",
        "name": "Менеджер"
    },
    "email": "employer@example.com",
    "full_name": "Иванов Иван Иванович",
    "last_name": "Иванов",
    "first_name": "Иван",
    "middle_name": "Иванович",
    "vacancies_count": 0,
    "phone": {
        "country": "7",
        "city": "495",
        "number": "1568055",
        "comment": "с 9 до 17"
    },
    "additional_phone": {
        "country": "7",
        "city": "916",
        "number": "4555555",
        "comment": "личный"
    },
    "position": "Менеджер",
    "permissions": [
       {
           "id": "can_create_vacancy",
           "name": "Создание и продление вакансий"
       },
       {
           "id": "can_view_resume_contacts",
           "name": "Просмотр контактов соискателей"
       }
    ],
    "area": {
        "id": "1",
        "name": "Москва",
        "url": "https://api.hh.ru/areas/1"
    }
}
```

Поля объекта аналогичны полям в [справочнике менеджеров](#fields), а также
дополнительно выдаются поля:

Имя | Тип | Описание
--- | --- | --------
permissions | список | список [прав менеджера](#dict)

### Ошибки
* `404 Not found` - Работодатель или менеджер не найдены, или у пользователя нет прав


